<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WillBoot-PRO ‚Ä¢ Aviator IA</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { background:#050505; font-family:sans-serif; color:white; }
  .glass { background:rgba(255,255,255,0.04); backdrop-filter:blur(16px); border-radius:16px; }
  .neon-red { box-shadow:0 0 25px rgba(220,38,38,.6); }
  .btn-red { background:#dc2626; padding:12px 24px; border-radius:12px; font-weight:bold; cursor:pointer; transition:0.3s; }
  .btn-red:hover { background:#b91c1c; }
  .btn-gray { background:#111; padding:12px 24px; border-radius:12px; font-weight:bold; cursor:pointer; transition:0.3s; }
  .btn-gray:hover { background:#222; }
  .signal-card { padding:16px; border-radius:12px; text-align:center; transition:0.3s; border-width: 2px; }
</style>
</head>
<body>

<div id="page1" class="min-h-screen flex items-center justify-center">
  <div class="glass p-10 w-full max-w-md border border-red-600/30">
    <h1 class="text-3xl font-black text-red-600 mb-6 text-center">WILLBOOT-PRO</h1>
    <input id="userMain" placeholder="Usu√°rio" class="w-full mb-4 p-3 rounded bg-black border border-gray-700">
    <input id="passMain" type="password" placeholder="Senha" class="w-full mb-6 p-3 rounded bg-black border border-gray-700">
    <button class="btn-red w-full neon-red mb-4" onclick="loginMain()">üîê ENTRAR</button>
    <p class="text-center text-gray-400 text-sm">Acesso normal ao site</p>
  </div>
</div>

<div id="page2" class="hidden max-w-7xl mx-auto px-6 py-10">
  
  <div class="glass p-6 border border-red-600/20 mb-6">
    <div class="flex flex-col md:flex-row justify-between items-center mb-6">
      <div id="clock2" class="text-red-500 font-bold text-xl"></div>
      <div class="flex gap-4 mt-4 md:mt-0">
        <button class="btn-red neon-red" onclick="analyzeHistory()">üî• GERAR SINAIS / ANALISAR</button>
        <button class="btn-gray" onclick="logoutMain()">üö™ SAIR</button>
      </div>
    </div>
    
    <div class="bg-black/40 p-4 rounded-xl border border-gray-800 text-center">
      <label class="block mb-2 font-bold text-gray-300">Escolha o Print do Hist√≥rico:</label>
      <input type="file" id="uploadHistory" accept="image/*" class="text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700">
      <p id="historyResult" class="mt-2 text-xs text-red-400 font-medium uppercase"></p>
    </div>
  </div>

  <div id="signalsPage2" class="grid md:grid-cols-3 gap-6 my-10">
     <div class="glass p-6 border border-red-600/20 text-center text-gray-300 col-span-3">
      Aguardando an√°lise do hist√≥rico para gerar sinais...
    </div>
  </div>

  <div class="glass p-6 mb-6 border border-red-600/20">
    <label class="mb-2 block font-bold">Escolha a Casa de Aposta:</label>
    <select id="betHouse" class="w-full p-3 rounded bg-black border border-gray-700">
      <option value="ElephantBet">ElephantBet</option>
      <option value="BantuBet">BantuBet</option>
      <option value="888Bet">888Bet</option>
      <option value="TopAposta">TopAposta</option>
    </select>
  </div>

  <div class="glass p-6 rounded-xl border border-red-600/20">
    <h3 class="text-center font-bold mb-4">üìä Performance IA (Hist√≥rico Real)</h3>
    <canvas id="chartPage2" height="120"></canvas>
  </div>

  <div class="glass p-8 mt-10 border border-red-600/30 text-center">
    <h2 class="text-2xl font-black text-red-600 mb-4">üíé ACESSO VIP</h2>
    <p class="text-gray-300 mb-4">Sinais ROSA de alta probabilidade ‚Ä¢ IA treinada</p>
    <input id="vipUser" placeholder="Usu√°rio VIP" class="w-full mb-2 p-3 rounded bg-black border border-gray-700">
    <input id="vipPass" type="password" placeholder="Senha VIP" class="w-full mb-4 p-3 rounded bg-black border border-gray-700">
    <button class="btn-red neon-red w-full" onclick="loginVIP()">üîê ENTRAR VIP</button>
  </div>
</div>

<div id="page3" class="hidden max-w-7xl mx-auto px-6 py-10">
  <h1 class="text-3xl font-black text-red-600 mb-6 text-center">üíé VIP - Sinais ROSA</h1>

  <div class="glass p-4 mb-6 text-center border border-red-600/20">
    <div id="clock3" class="text-red-500 font-bold text-xl"></div>
  </div>

  <div id="signalsVIP" class="grid md:grid-cols-3 gap-6 my-6"></div>

  <div class="glass p-6 rounded-xl border border-red-600/20">
    <h3 class="text-center font-bold mb-4">üìä Performance VIP (Aviator)</h3>
    <canvas id="chartVIP" height="120"></canvas>
  </div>

  <div class="glass p-6 mt-6 text-center border border-red-600/30">
    <p class="text-gray-300">Usu√°rio VIP: William | Passe: 230220</p>
    <button class="btn-gray mt-4" onclick="location.reload()">‚¨Ö VOLTAR AO IN√çCIO</button>
  </div>

  <div class="glass p-6 mb-6 mt-10 border border-red-600/20 text-center">
    <label class="block mb-2 font-bold">Enviar hist√≥rico Aviator VIP (PNG/JPG)</label>
    <input type="file" id="uploadHistoryVIP" accept="image/*" class="mb-4">
    <button class="btn-red neon-red" onclick="analyzeHistoryVIP()">üìä ANALISAR VIP</button>
    <p id="historyResultVIP" class="mt-2 text-gray-300"></p>
  </div>
</div>

<script>
const BACKEND_URL = "https://willboot-backend-1.onrender.com";

/** REL√ìGIOS **/
setInterval(()=>{
  const now = new Date().toLocaleString("pt-PT",{timeZone:"Africa/Luanda"});
  if(document.getElementById("clock2")) clock2.innerHTML="üïê "+now;
  if(document.getElementById("clock3")) clock3.innerHTML="üïê "+now;
},1000);

/** LOGIN (admin / 1234) **/
function loginMain(){
  const u=userMain.value, p=passMain.value;
  if(u === "admin" && p === "1234"){
    localStorage.setItem("mainAccess","true");
    document.getElementById("page1").classList.add("hidden");
    document.getElementById("page2").classList.remove("hidden");
    loadHistoryPage2();
  } else { alert("Acesso negado."); }
}
function logoutMain(){
  localStorage.removeItem("mainAccess");
  location.reload();
}
if(localStorage.getItem("mainAccess")) {
  window.onload = () => {
    document.getElementById("page1").classList.add("hidden");
    document.getElementById("page2").classList.remove("hidden");
    loadHistoryPage2();
  }
}

/** L√ìGICA DE NORMALIZA√á√ÉO E TRATAMENTO **/
function pick(obj, keys, fallback=null){
  for(const k of keys){
    if(obj && Object.prototype.hasOwnProperty.call(obj, k)) return obj[k];
  }
  return fallback;
}

function normalizeAnalyzeResponse(data){
  const analysis = pick(data, ["analysis","analise","result"], {}) || {};
  let sinal = String(pick(analysis, ["sinal","signal"], "")).toUpperCase();
  const mult = parseFloat(pick(analysis, ["mult","multiplo"], 1.0));
  
  // For√ßar l√≥gica de cores baseada no multiplicador
  if(mult < 2.0) sinal = "AZUL";
  else if(mult >= 2.0 && mult < 10.0) sinal = "ROXO";
  else sinal = "ROSA";

  return {
    sinal: sinal,
    mult: mult.toFixed(2),
    azul: pick(analysis, ["azul_pct","azul"], 0),
    roxo: pick(analysis, ["roxo_pct","roxo"], 0),
    rosa: pick(analysis, ["rosa_pct","rosa"], 0),
    conf: pick(analysis, ["confianca","conf"], 50)
  };
}

/** GR√ÅFICOS **/
let historyPage2 = JSON.parse(localStorage.getItem("historyPage2")||"[]");
let chartPage2Obj;

function loadHistoryPage2(){ updateChartPage2(); }

function updateChartPage2(){
  if(historyPage2.length>50) historyPage2=historyPage2.slice(-50);
  localStorage.setItem("historyPage2",JSON.stringify(historyPage2));
  if(chartPage2Obj) chartPage2Obj.destroy();
  chartPage2Obj = new Chart(chartPage2.getContext("2d"),{
    type:"line",
    data:{
      labels:historyPage2.map((_,i)=>i+1),
      datasets:[{
        data:historyPage2, borderColor:"#dc2626", backgroundColor:"rgba(220,38,38,.2)", tension:.4, fill:true
      }]
    },
    options:{plugins:{legend:{display:false}}, scales:{y:{min:0,max:100}}}
  });
}

/** ANALISAR E GERAR SINAIS (TUDO EM UM) **/
let lastAnalyze = null;

async function analyzeHistory(){
  const file = document.getElementById("uploadHistory").files[0];
  if(!file){ alert("Selecione uma imagem do hist√≥rico primeiro!"); return; }

  document.getElementById("historyResult").innerHTML = "‚åõ PROCESSANDO HIST√ìRICO...";

  const formData = new FormData();
  formData.append("file", file);

  try {
    const res = await fetch(`${BACKEND_URL}/analyze`, { method: "POST", body: formData });
    const data = await res.json();
    lastAnalyze = normalizeAnalyzeResponse(data);
    
    document.getElementById("historyResult").innerHTML = "‚úÖ AN√ÅLISE CONCLU√çDA!";
    renderSignalsPage2(lastAnalyze);
    
    // Atualiza gr√°fico
    historyPage2.push(lastAnalyze.conf);
    updateChartPage2();
  } catch(err) {
    document.getElementById("historyResult").innerHTML = "‚ùå ERRO AO CONECTAR SERVIDOR.";
  }
}

function renderSignalsPage2(info){
  const cards = [
    {t:"AZUL", c:"blue-500", pct: info.azul, limit: "1.00x - 1.99x"},
    {t:"ROXO", c:"purple-500", pct: info.roxo, limit: "2.00x - 9.99x"}
  ];

  // Filtramos para n√£o mostrar Rosa na p√°gina normal se quiser manter exclusivo
  signalsPage2.innerHTML = cards.map(x=>{
    const recommended = (info.sinal === x.t);
    return `
      <div class="signal-card glass ${recommended ? 'border-white scale-105' : 'border-gray-800 opacity-50'}">
        <h3 class="font-bold text-${x.c}">${recommended ? 'üî• ' : ''}SINAL ${x.t}</h3>
        <div class="text-4xl font-black my-2">${recommended ? '√ó'+info.mult : '---'}</div>
        <p class="text-xs text-gray-400">${x.limit}</p>
        <p class="mt-2 text-sm">Precis√£o: ${x.pct}%</p>
      </div>`;
  }).join("");
  
  // Adiciona o aviso de Rosa para VIP
  if(info.sinal === "ROSA") {
     signalsPage2.innerHTML += `
      <div class="signal-card glass border-pink-600 bg-pink-900/10 col-span-1">
        <h3 class="font-bold text-pink-400">üíé SINAL ROSA</h3>
        <p class="text-xs">Dispon√≠vel apenas no Painel VIP</p>
      </div>`;
  }
}

/** VIP (William / 230220) **/
function loginVIP(){
  const u=vipUser.value, p=vipPass.value;
  if(u === "William" && p === "230220"){
    document.getElementById("page2").classList.add("hidden");
    document.getElementById("page3").classList.remove("hidden");
  } else { alert("Acesso VIP negado."); }
}

async function analyzeHistoryVIP(){
  const file = document.getElementById("uploadHistoryVIP").files[0];
  if(!file){ return; }
  try {
    const formData = new FormData();
    formData.append("file", file);
    const res = await fetch(`${BACKEND_URL}/analyze`, { method: "POST", body: formData });
    const data = await res.json();
    const info = normalizeAnalyzeResponse(data);
    
    signalsVIP.innerHTML = `
      <div class="signal-card glass border-pink-500 col-span-3">
        <h1 class="text-pink-500 font-bold">üöÄ ENTRADA ROSA CONFIRMADA</h1>
        <div class="text-6xl font-black my-4">√ó${info.mult}</div>
        <p>Probabilidade de acerto: ${info.rosa}%</p>
      </div>`;
  } catch(e) {}
}
</script>
</body>
</html>
