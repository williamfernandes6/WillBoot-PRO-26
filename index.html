<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WillBoot-PRO ‚Ä¢ Aviator IA</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { background:#050505; font-family:sans-serif; color:white; }
  .glass { background:rgba(255,255,255,0.04); backdrop-filter:blur(16px); border-radius:16px; }
  .neon-red { box-shadow:0 0 25px rgba(220,38,38,.6); }
  .btn-red { background:#dc2626; padding:12px 24px; border-radius:12px; font-weight:bold; cursor:pointer; transition:0.3s; }
  .btn-red:hover { background:#b91c1c; }
  .btn-gray { background:#111; padding:12px 24px; border-radius:12px; font-weight:bold; cursor:pointer; transition:0.3s; }
  .btn-gray:hover { background:#222; }
  .signal-card { padding:16px; border-radius:12px; text-align:center; transition:0.3s; }
</style>
</head>
<body>

<div id="page1" class="min-h-screen flex items-center justify-center">
  <div class="glass p-10 w-full max-w-md border border-red-600/30">
    <h1 class="text-3xl font-black text-red-600 mb-6 text-center">WILLBOOT-PRO</h1>
    <input id="userMain" placeholder="Usu√°rio" class="w-full mb-4 p-3 rounded bg-black border border-gray-700 outline-none focus:border-red-600">
    <input id="passMain" type="password" placeholder="Senha" class="w-full mb-6 p-3 rounded bg-black border border-gray-700 outline-none focus:border-red-600">
    <button class="btn-red w-full neon-red mb-4" onclick="loginMain()">üîê ENTRAR</button>
    <p class="text-center text-gray-400 text-sm">Acesso Administrativo</p>
  </div>
</div>

<div id="page2" class="hidden max-w-7xl mx-auto px-6 py-10">
  <div class="glass p-6 flex flex-col md:flex-row justify-between items-center border border-red-600/20 mb-6">
    <div id="clock2" class="text-red-500 font-bold text-xl"></div>
    <div class="flex gap-4 mt-4 md:mt-0">
      <button class="btn-red" onclick="generateSignalsPage2()">üî• GERAR SINAIS</button>
      <button class="btn-gray" onclick="logoutMain()">üö™ SAIR</button>
    </div>
  </div>

  <div id="signalsPage2" class="grid md:grid-cols-3 gap-6 my-10"></div>

  <div class="glass p-6 mb-6 border border-red-600/20">
    <label class="mb-2 block font-bold">Escolha a Casa de Aposta:</label>
    <select id="betHouse" class="w-full p-3 rounded bg-black border border-gray-700">
      <option value="ElephantBet">ElephantBet</option>
      <option value="BantuBet">BantuBet</option>
      <option value="888Bet">888Bet</option>
      <option value="TopAposta">TopAposta</option>
    </select>
  </div>

  <div class="glass p-6 rounded-xl border border-red-600/20">
    <h3 class="text-center font-bold mb-4">üìä Performance IA (Hist√≥rico Real)</h3>
    <canvas id="chartPage2" height="120"></canvas>
  </div>

  <div class="glass p-8 mt-10 border border-red-600/30 text-center">
    <h2 class="text-2xl font-black text-red-600 mb-4">üíé ACESSO VIP</h2>
    <p class="text-gray-300 mb-4">Sinais ROSA de alta probabilidade</p>
    <input id="vipUser" placeholder="Usu√°rio VIP" class="w-full mb-2 p-3 rounded bg-black border border-gray-700 outline-none">
    <input id="vipPass" type="password" placeholder="Senha VIP" class="w-full mb-4 p-3 rounded bg-black border border-gray-700 outline-none">
    <button class="btn-red neon-red w-full" onclick="loginVIP()">üîê ENTRAR VIP</button>
  </div>

  <div class="glass p-6 mb-6 mt-10 border border-red-600/20 text-center">
    <label class="block mb-2 font-bold">Enviar hist√≥rico Aviator (PNG/JPG)</label>
    <input type="file" id="uploadHistory" accept="image/*" class="mb-4 text-sm">
    <button class="btn-red neon-red" onclick="analyzeHistory()">üìä ANALISAR</button>
    <p id="historyResult" class="mt-2 text-gray-300"></p>
  </div>
</div>

<div id="page3" class="hidden max-w-7xl mx-auto px-6 py-10">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-black text-red-600">üíé VIP - Sinais ROSA</h1>
    <button class="btn-gray" onclick="window.location.reload()">‚¨Ö VOLTAR</button>
  </div>
  <div class="glass p-4 mb-6 text-center border border-red-600/20">
    <div id="clock3" class="text-red-500 font-bold text-xl"></div>
  </div>
  <div id="signalsVIP" class="grid md:grid-cols-3 gap-6 my-6"></div>
  <div class="glass p-6 rounded-xl border border-red-600/20">
    <h3 class="text-center font-bold mb-4">üìä Performance VIP (Aviator)</h3>
    <canvas id="chartVIP" height="120"></canvas>
  </div>
  <div class="glass p-6 mb-6 mt-10 border border-red-600/20 text-center">
    <label class="block mb-2 font-bold">Enviar hist√≥rico Aviator VIP (PNG/JPG)</label>
    <input type="file" id="uploadHistoryVIP" accept="image/*" class="mb-4">
    <button class="btn-red neon-red" onclick="analyzeHistoryVIP()">üìä ANALISAR VIP</button>
    <p id="historyResultVIP" class="mt-2 text-gray-300"></p>
  </div>
</div>

<script>
const BACKEND_URL = "https://willboot-backend-1.onrender.com";

/** REL√ìGIOS **/
setInterval(()=>{
  const now = new Date().toLocaleString("pt-PT",{timeZone:"Africa/Luanda"});
  if(document.getElementById("clock2")) document.getElementById("clock2").innerHTML="üïê "+now;
  if(document.getElementById("clock3")) document.getElementById("clock3").innerHTML="üïê "+now;
},1000);

/** LOGIN PRINCIPAL (admin / 1234) **/
function loginMain(){
  const u = document.getElementById("userMain").value;
  const p = document.getElementById("passMain").value;
  
  if(u === "admin" && p === "1234"){
    localStorage.setItem("mainAccess","true");
    showDashboard();
  } else {
    alert("Usu√°rio ou Senha incorretos!");
  }
}

function showDashboard(){
  document.getElementById("page1").classList.add("hidden");
  document.getElementById("page2").classList.remove("hidden");
  loadHistoryPage2();
}

function logoutMain(){
  localStorage.removeItem("mainAccess");
  location.reload();
}

/** LOGIN VIP (William / 230220) **/
function loginVIP(){
  const u = document.getElementById("vipUser").value;
  const p = document.getElementById("vipPass").value;
  
  if(u === "William" && p === "230220"){
    document.getElementById("page2").classList.add("hidden");
    document.getElementById("page3").classList.remove("hidden");
    loadHistoryVIP();
  } else {
    alert("Dados VIP incorretos!");
  }
}

// Verifica se j√° est√° logado ao abrir
if(localStorage.getItem("mainAccess") === "true") {
    showDashboard();
}

/** GR√ÅFICOS **/
let historyPage2 = JSON.parse(localStorage.getItem("historyPage2")||"[]");
let chartPage2Obj;

function loadHistoryPage2(){ updateChartPage2(); }

function updateChartPage2(){
  const ctx = document.getElementById("chartPage2").getContext("2d");
  if(chartPage2Obj) chartPage2Obj.destroy();
  chartPage2Obj = new Chart(ctx,{
    type:"line",
    data:{
      labels:historyPage2.map((_,i)=>i+1),
      datasets:[{
        data:historyPage2,
        borderColor:"#dc2626",
        backgroundColor:"rgba(220,38,38,.2)",
        tension:.4, fill:true
      }]
    },
    options:{plugins:{legend:{display:false}}, scales:{y:{min:0,max:100}}}
  });
}

/** AN√ÅLISE DE SINAIS **/
let lastAnalyze = null;

function normalizeAnalyzeResponse(data){
  // Simplificado para ler o que o backend envia
  const a = data.analysis || {};
  return {
    sinal: a.sinal || "AZUL",
    mult: a.mult || "1.00",
    conf: a.confianca || 50,
    azul: a.azul_pct || 0,
    roxo: a.roxo_pct || 0,
    rosa: a.rosa_pct || 0,
    total: data.total || 0
  };
}

async function analyzeHistory(){
  const file = document.getElementById("uploadHistory").files[0];
  const resDiv = document.getElementById("historyResult");
  if(!file){ resDiv.innerHTML = "Selecione um arquivo!"; return; }
  
  resDiv.innerHTML = "Analisando...";
  const fd = new FormData();
  fd.append("file", file);

  try{
    const res = await fetch(`${BACKEND_URL}/analyze`, { method: "POST", body: fd });
    const data = await res.json();
    lastAnalyze = normalizeAnalyzeResponse(data);
    resDiv.innerHTML = `Sinal: ${lastAnalyze.sinal} | Confian√ßa: ${lastAnalyze.conf}%`;
    generateSignalsPage2();
  } catch(e) {
    resDiv.innerHTML = "Erro ao conectar ao servidor Render.";
  }
}

function generateSignalsPage2(){
  const container = document.getElementById("signalsPage2");
  if(!lastAnalyze){
    container.innerHTML = `<div class="glass p-6 text-center w-full col-span-3">Envie um hist√≥rico primeiro.</div>`;
    return;
  }
  
  const cards = [
    {t:"AZUL", c:"cyan-400", p: lastAnalyze.azul},
    {t:"ROXO", c:"purple-400", p: lastAnalyze.roxo},
    {t:"ROSA", c:"pink-400", p: lastAnalyze.rosa}
  ];

  container.innerHTML = cards.map(x => `
    <div class="signal-card glass border ${lastAnalyze.sinal === x.t ? 'border-red-600 scale-105' : 'border-gray-800'}">
      <h3 class="font-bold text-${x.c}">${lastAnalyze.sinal === x.t ? '‚úÖ ' : ''}SINAL ${x.t}</h3>
      <div class="text-4xl font-black my-2">√ó${lastAnalyze.mult}</div>
      <p>Probabilidade: ${x.p}%</p>
    </div>
  `).join("");

  historyPage2.push(lastAnalyze.conf);
  if(historyPage2.length > 20) historyPage2.shift();
  localStorage.setItem("historyPage2", JSON.stringify(historyPage2));
  updateChartPage2();
}

// Fun√ß√µes VIP Simplificadas para seguir o padr√£o
function loadHistoryVIP(){ updateChartVIP(); }
let historyVIP = JSON.parse(localStorage.getItem("historyVIP")||"[]");
let chartVIPObj;

function updateChartVIP(){
  const ctx = document.getElementById("chartVIP").getContext("2d");
  if(chartVIPObj) chartVIPObj.destroy();
  chartVIPObj = new Chart(ctx,{
    type:"line",
    data:{
      labels:historyVIP.map((_,i)=>i+1),
      datasets:[{
        data:historyVIP,
        borderColor:"#db2777",
        tension:.4, fill:false
      }]
    }
  });
}

async function analyzeHistoryVIP(){
  // Reutiliza a l√≥gica de an√°lise para o VIP
  await analyzeHistory();
  if(lastAnalyze){
      document.getElementById("signalsVIP").innerHTML = `
        <div class="signal-card glass border border-pink-600 col-span-3">
          <h3 class="font-bold text-pink-400">üíé SINAL VIP ROSA</h3>
          <div class="text-5xl font-black my-4">√ó${lastAnalyze.mult}</div>
          <p>Confian√ßa IA: ${lastAnalyze.rosa}%</p>
        </div>
      `;
      historyVIP.push(lastAnalyze.rosa);
      updateChartVIP();
  }
}
</script>
</body>
</html>
